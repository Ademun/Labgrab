{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Application Configuration",
  "type": "object",
  "properties": {
    "dikidi_client": {
      "type": "object",
      "properties": {
        "http": {
          "type": "object",
          "properties": {
            "timeout": {
              "type": "string",
              "description": "Duration string (e.g., '30s', '1m')",
              "pattern": "^[0-9]+(ns|us|µs|ms|s|m|h)$",
              "examples": ["30s", "1m", "5m"]
            },
            "increase": {
              "type": "number",
              "description": "Rate increase factor",
              "minimum": 1.0,
              "examples": [1.5, 2.0]
            },
            "decrease": {
              "type": "number",
              "description": "Rate decrease factor",
              "maximum": 2.0,
              "minimum": 0.0,
              "examples": [0.5, 0.75]
            },
            "max_rate": {
              "type": "number",
              "description": "Maximum requests per second",
              "minimum": 0,
              "examples": [100, 1000]
            },
            "min_rate": {
              "type": "number",
              "description": "Minimum requests per second",
              "minimum": 0,
              "examples": [1, 10]
            },
            "burst": {
              "type": "integer",
              "description": "Burst size for rate limiter",
              "minimum": 1,
              "examples": [10, 50]
            }
          },
          "required": ["timeout", "increase", "decrease", "max_rate", "min_rate", "burst"],
          "additionalProperties": false
        },
        "sources": {
          "type": "object",
          "properties": {
            "sources_ids_provider": {
              "type": "string",
              "format": "uri",
              "description": "URL for sources IDs provider",
              "examples": ["https://api.example.com/sources"]
            },
            "slots_source": {
              "type": "string",
              "format": "uri",
              "description": "URL for slots source",
              "examples": ["https://api.example.com/slots"]
            }
          },
          "required": ["sources_ids_provider", "slots_source"],
          "additionalProperties": false
        }
      },
      "required": ["http", "sources"],
      "additionalProperties": false
    },
    "polling_service": {
        "type": "object",
        "properties": {
          "parser": {
            "type": ["object", "null"],
            "properties": {
              "number_pattern": {
                "type": "string",
                "description": "Regular expression pattern for parsing numbers",
                "examples": ["\\d+", "[0-9]{1,4}", "\\b\\d+\\b"]
              },
              "auditorium_pattern": {
                "type": "string",
                "description": "Regular expression pattern for parsing auditorium identifiers",
                "examples": ["[A-Z]+-\\d+", "ауд\\.?\\s*\\d+", "room\\s+[A-Z0-9]+"]
              },
              "spot_pattern": {
                "type": "string",
                "description": "Regular expression pattern for parsing spot/location identifiers",
                "examples": ["место\\s+\\d+", "seat\\s+[A-Z]?\\d+", "[A-Z]\\d{1,3}"]
              },
              "topic_pattern": {
                "type": "string",
                "description": "Regular expression pattern for extracting topics",
                "examples": ["\\[(.*?)\\]", "тема:\\s*(.+)", "topic:\\s*(.+)"]
              },
              "name_prefix": {
                "type": "string",
                "description": "Prefix to add to parsed names",
                "examples": ["EVENT_", "SLOT_", ""]
              },
              "timezone": {
                "type": "string",
                "description": "IANA timezone name for time parsing",
                "pattern": "^[A-Za-z_]+/[A-Za-z_]+$",
                "examples": ["Europe/Tallinn", "UTC", "America/New_York", "Asia/Tokyo"]
              },
              "topic_map": {
                "type": "object",
                "description": "Mapping from raw topic identifiers to normalized topic names",
                "additionalProperties": {
                  "type": "string"
                },
                "examples": [
                  {
                    "math": "Mathematics",
                    "cs": "Computer Science",
                    "phys": "Physics"
                  }
                ]
              },
              "type_map": {
                "type": "object",
                "description": "Mapping from raw type identifiers to normalized type names",
                "additionalProperties": {
                  "type": "string"
                },
                "examples": [
                  {
                    "lec": "lecture",
                    "lab": "laboratory",
                    "sem": "seminar"
                  }
                ]
              },
              "default_type": {
                "type": "string",
                "description": "Default type to use when type cannot be determined",
                "examples": ["unknown", "general", "lecture"]
              }
            },
            "required": [
              "number_pattern",
              "auditorium_pattern",
              "spot_pattern",
              "topic_pattern",
              "timezone",
              "default_type"
            ],
            "additionalProperties": false
          }
        }
    },
    "subscription_service": {
      "type": "object",
      "properties": {
        "deduplicator": {
          "type": ["object", "null"],
          "properties": {
            "key_prefix": {
              "type": "string",
              "description": "Prefix for deduplication keys",
              "examples": ["dedup:", "cache:"]
            },
            "ttl": {
              "type": "string",
              "description": "Time to live as duration string",
              "pattern": "^[0-9]+(ns|us|µs|ms|s|m|h)$",
              "examples": ["1h", "24h", "168h"]
            }
          },
          "required": ["key_prefix", "ttl"],
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  },
  "required": ["dikidi_client", "polling_service", "subscription_service"],
  "additionalProperties": false
}